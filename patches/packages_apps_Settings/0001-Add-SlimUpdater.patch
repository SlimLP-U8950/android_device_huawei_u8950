From 7508760d3bc41077201f2a68070f2bd6251cf4d4 Mon Sep 17 00:00:00 2001
From: ksrt12 <kazakov12stepan2012@live.ru>
Date: Sat, 12 Sep 2015 19:45:20 +0600
Subject: [PATCH] Add SlimUpdater

Change-Id: Ic652daf7037e05aeae21590d1d8857b86bdceef6
---
 res/values-ru/slim_strings.xml                   | 1 +
 res/values/slim_strings.xml                      | 3 +++
 res/xml/device_info_settings.xml                 | 9 +++++++++
 src/com/android/settings/DeviceInfoSettings.java | 8 ++++++++
 4 files changed, 21 insertions(+)

diff --git a/res/values-ru/slim_strings.xml b/res/values-ru/slim_strings.xml
index 1046071..366a3bd 100644
--- a/res/values-ru/slim_strings.xml
+++ b/res/values-ru/slim_strings.xml
@@ -915,4 +915,5 @@
   <string name="performance_set_on_boot_summary">Применять текущие настройки при перезагрузке</string>
   <string name="autoperf_title">Профили приложений</string>
   <string name="autoperf_summary">Автоматически переключать профиль производительности в зависимости от приложения</string>
+  <string name="slimupdate_settings_title">Обновления SlimLP</string>
 </resources>
diff --git a/res/values/slim_strings.xml b/res/values/slim_strings.xml
index abd3d68..51ff991 100644
--- a/res/values/slim_strings.xml
+++ b/res/values/slim_strings.xml
@@ -53,6 +53,9 @@
     <!-- Slim Shortcuts -->
     <string name="slim_shortcut_picker">Slim Actions</string>
 
+    <!-- Slim Updater -->
+    <string name="slimupdate_settings_title">SlimLP updates</string>
+
     <!-- About device screen, Slim version -->
     <string name="slim_version_title">Slim version</string>
     <string name="slim_version_default">Unknown</string>
diff --git a/res/xml/device_info_settings.xml b/res/xml/device_info_settings.xml
index 165c56d..eb3f275 100644
--- a/res/xml/device_info_settings.xml
+++ b/res/xml/device_info_settings.xml
@@ -21,6 +21,15 @@
                           android:enabled="false"
                           android:layout="@layout/slim_logo_row" />
 
+        <!-- Slim Updates -->
+        <PreferenceScreen android:key="slim_updates"
+                android:title="@string/slimupdate_settings_title"
+                android:summary="@string/system_update_settings_list_item_summary">
+            <intent android:action="android.intent.action.MAIN"
+                    android:targetPackage="com.ksrt12.updater"
+                    android:targetClass="com.ksrt12.updater.UpdatesSettings" />
+        </PreferenceScreen>
+
         <!-- Device status - launches activity -->
         <PreferenceScreen android:key="status_info"
                 android:title="@string/device_status" 
diff --git a/src/com/android/settings/DeviceInfoSettings.java b/src/com/android/settings/DeviceInfoSettings.java
index 4168867..c3a4ffa 100644
--- a/src/com/android/settings/DeviceInfoSettings.java
+++ b/src/com/android/settings/DeviceInfoSettings.java
@@ -79,6 +79,7 @@ public class DeviceInfoSettings extends SettingsPreferenceFragment implements In
     private static final String KEY_FIRMWARE_VERSION = "firmware_version";
     private static final String KEY_SLIM_VERSION = "slim_version";
     private static final String KEY_SLIM_BUILD_DATE = "build_date";
+    private static final String KEY_SLIM_UPDATES = "slim_updates";
     private static final String KEY_EQUIPMENT_ID = "fcc_equipment_id";
     private static final String PROPERTY_EQUIPMENT_ID = "ro.ril.fccid";
     private static final String KEY_DEVICE_FEEDBACK = "device_feedback";
@@ -122,6 +123,13 @@ public class DeviceInfoSettings extends SettingsPreferenceFragment implements In
         removePreferenceIfPropertyMissing(getPreferenceScreen(), KEY_SELINUX_STATUS,
                 PROPERTY_SELINUX_STATUS);
 
+        // Only the owner should see the Updater settings, if it exists
+        if (UserHandle.myUserId() == UserHandle.USER_OWNER) {
+            removePreferenceIfPackageNotInstalled(findPreference(KEY_SLIM_UPDATES));
+        } else {
+            getPreferenceScreen().removePreference(findPreference(KEY_SLIM_UPDATES));
+        }
+
         String cpuInfo = getCPUInfo();
         String memInfo = getMemInfo();
 
-- 
2.1.4

